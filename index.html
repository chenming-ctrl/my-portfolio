<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chenming LI | Neural Architecture Portfolio</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --bg-blur: 0px; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #fff; font-family: "Helvetica Neue", sans-serif; overflow: hidden; touch-action: none; }
        #canvas-container { position: fixed; width: 100%; height: 100%; z-index: 1; transition: filter 1s ease; filter: blur(var(--bg-blur)); pointer-events: none; }
        
        nav { position: fixed; top: 0; left: 0; width: 100%; padding: 40px 60px; display: flex; justify-content: space-between; align-items: center; z-index: 5000; box-sizing: border-box; opacity: 0; transform: translateY(-20px); transition: 0.8s ease; pointer-events: none; }
        nav.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .nav-logo { font-size: 0.9rem; font-weight: 600; letter-spacing: 2px; cursor: pointer; color: #000; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { text-decoration: none; color: #999; font-size: 0.6rem; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        .nav-links a:hover { color: #000; }

        .view-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; opacity: 0; visibility: hidden; transition: 0.8s cubic-bezier(0.165, 0.84, 0.44, 1); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .view-layer.active { opacity: 1; visibility: visible; }

        /* --- 各级层的堆叠特效 --- */
        .neural-grid { display: flex; gap: 50px; justify-content: center; align-items: center; width: 90%; flex-wrap: wrap; padding: 40px; }
        .stack-container { position: relative; width: 160px; height: 200px; cursor: pointer; text-align: center; perspective: 1000px; }
        .neural-stack { position: relative; width: 130px; height: 130px; transform-style: preserve-3d; margin: 0 auto; transition: 0.5s; }
        .neural-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #fff; border: 1px solid rgba(0,0,0,0.06); overflow: hidden; transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1); box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .neural-layer img { width: 100%; height: 100%; object-fit: cover; }
        
        /* 堆叠层级偏移 */
        .layer-1 { z-index: 5; transform: translateZ(0px); }
        .layer-2 { z-index: 4; transform: translate(8px, -8px); opacity: 0.7; }
        .layer-3 { z-index: 3; transform: translate(16px, -16px); opacity: 0.4; }

        /* 悬停爆炸效果 */
        .stack-container:hover .layer-1 { transform: translate(-20px, -20px) rotate(-5deg); box-shadow: 20px 20px 40px rgba(0,0,0,0.1); }
        .stack-container:hover .layer-2 { transform: translate(10px, 5px) rotate(3deg); opacity: 0.9; }
        .stack-container:hover .layer-3 { transform: translate(25px, 20px) rotate(8deg); opacity: 0.6; }
        
        .stack-label { margin-top: 30px; font-size: 0.6rem; letter-spacing: 3px; text-transform: uppercase; color: #bbb; transition: 0.4s; }
        .stack-container:hover .stack-label { color: #000; transform: translateY(5px); }

        /* --- 第四级 Miro 功能样式 --- */
        #lvl4 { background: #fbfbfb; z-index: 6000; cursor: grab; }
        .lvl4-header { position: fixed; top: 100px; left: 60px; z-index: 7000; pointer-events: none; }
        .lvl4-project-title { font-size: 1.8rem; font-weight: 200; letter-spacing: 8px; text-transform: uppercase; color: #000; outline: none; pointer-events: auto; }
        
        #miro-viewport { position: absolute; width: 100%; height: 100%; transform-origin: 0 0; }
        .miro-item { position: absolute; background: white; padding: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 2px solid transparent; transition: border 0.3s; }
        .miro-item.selected { border-color: #000; }
        .miro-item img { display: block; width: 100%; height: auto; pointer-events: none; }
        .resizer { width: 14px; height: 14px; background: #000; position: absolute; right: -7px; bottom: -7px; cursor: nwse-resize; border-radius: 50%; border: 2px solid #fff; opacity: 0; }
        .miro-item.selected .resizer { opacity: 1; }
        
        .miro-ui { position: fixed; bottom: 30px; left: 30px; z-index: 7000; display: flex; gap: 10px; }
        .ui-btn { background: #fff; padding: 12px 24px; border-radius: 40px; font-size: 0.6rem; letter-spacing: 1px; cursor: pointer; border: 1px solid #eee; text-transform: uppercase; transition: 0.3s; }
        .ui-btn:hover { background: #000; color: #fff; border-color: #000; }
        .admin-lock { position: fixed; bottom: 30px; right: 30px; font-size: 0.4rem; color: #ccc; cursor: pointer; z-index: 7001; text-align: right; letter-spacing: 1px; }
    </style>
</head>
<body>

<nav id="mainNav"><div class="nav-logo" onclick="showLevel(1)">CHENMING</div><div id="dynamicNav" class="nav-links"></div></nav>
<div id="canvas-container"><canvas id="particleCanvas"></canvas></div>

<div class="view-layer active" id="lvl1">
    <div onclick="showLevel(2)" style="cursor:pointer; text-align:center">
        <h1 style="font-size:3.5rem; font-weight:100; letter-spacing:20px; margin-bottom: 20px;">CHENMING LI</h1>
        <p style="font-size:0.55rem; color:#aaa; letter-spacing:8px; text-transform: uppercase;">Architecture & Computation Portfolio</p>
    </div>
</div>

<div id="lvl2" class="view-layer"><div class="neural-grid" id="catGrid"></div></div>
<div id="lvl3" class="view-layer"><div class="neural-grid" id="projGrid"></div></div>

<div id="lvl4" class="view-layer">
    <div class="lvl4-header">
        <div id="lvl4CatTag" style="font-size: 0.45rem; color: #ccc; letter-spacing: 4px; margin-bottom: 8px;">CATEGORY</div>
        <div id="lvl4Title" class="lvl4-project-title" spellcheck="false">PROJECT TITLE</div>
    </div>
    <div id="miro-viewport"></div>
    <div class="miro-ui" id="adminControls" style="display:none;">
        <button class="ui-btn" onclick="document.getElementById('fileInput').click()">+ ADD IMAGE</button>
        <button class="ui-btn" onclick="saveToCloud()">FORCE SAVE</button>
    </div>
    <div class="admin-lock" onclick="unlockAdmin()" id="adminInfo">ADMIN LOGIN<br><span style="opacity:0.5">PRESS ESC TO BACK</span></div>
    <input type="file" id="fileInput" hidden accept="image/*" onchange="handleUpload(event)">
</div>

<script>
    // --- 1. FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyDIQ48e3qR33xhvwDawYsyzZQpexiHAHNM",
        authDomain: "chenming-portfolio.firebaseapp.com",
        databaseURL: "https://chenming-portfolio-default-rtdb.firebaseio.com",
        projectId: "chenming-portfolio",
        storageBucket: "chenming-portfolio.firebasestorage.app",
        messagingSenderId: "645974382810",
        appId: "1:645974382810:web:0d314656d71dedbb6e6de3",
        measurementId: "G-6QT90T8DJ6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- 2. 五个方向 & 子项目数据结构 ---
    const portfolio = {
        'Architecture': { thumb: 'arch.jpg', projects: [
            {id:'a1', title:'Urban Parasite'}, {id:'a2', title:'Flowing Museum'}, {id:'a3', title:'Vertical Forest'}, {id:'a4', title:'Zen Pavillion'}
        ]},
        'Computational': { thumb: 'comp.jpg', projects: [
            {id:'c1', title:'Algorithmic Mesh'}, {id:'c2', title:'Cellular Growth'}, {id:'c3', title:'Bionic Structure'}
        ]},
        'Research': { thumb: 'research.jpg', projects: [
            {id:'r1', title:'Material Agency'}, {id:'r2', title:'Post-Human Urbanism'}, {id:'r3', title:'Carbon Neutrality'}
        ]},
        'Interior': { thumb: 'interior.jpg', projects: [
            {id:'i1', title:'Minimal Loft'}, {id:'i2', title:'Sensory Gallery'}, {id:'i3', title:'Light Space'}
        ]},
        'Visuals': { thumb: 'visual.jpg', projects: [
            {id:'v1', title:'Cyber City'}, {id:'v2', title:'Ethereal Series'}, {id:'v3', title:'Digital Nature'}, {id:'v4', title:'Unreal Engine 5'}
        ]}
    };

    let isAdmin = false, currentLvl = 1, currentCat = '', currentProj = null;
    let zoom = 1, panX = 0, panY = 0, isPanning = false, isDragging = false, isResizing = false;
    let dragTarget = null, resizeTarget = null, startX, startY, startW, selectedItem = null;

    // --- 3. 交互控制 ---
    window.addEventListener('keydown', e => {
        if (e.key === 'Escape' && document.activeElement !== document.getElementById('lvl4Title')) {
            if (currentLvl === 4) { if(isAdmin) saveToCloud(); showLevel(3, currentCat); }
            else if (currentLvl === 3) showLevel(2);
            else if (currentLvl === 2) showLevel(1);
        }
        if (e.key === 'Delete' && currentLvl === 4 && selectedItem && isAdmin) { selectedItem.remove(); selectedItem = null; }
    });

    function unlockAdmin() {
        if(isAdmin) return;
        const pass = prompt("Admin Password:");
        if(pass === "li123") {
            isAdmin = true;
            document.getElementById('adminControls').style.display = 'flex';
            document.getElementById('lvl4Title').contenteditable = true;
            document.getElementById('adminInfo').innerHTML = "ADMIN: ACTIVE<br><span style='color:#34A853'>AUTO-SAVE ENABLED</span>";
        }
    }

    // --- 4. 云端同步 ---
    async function syncFromCloud() {
        const snapshot = await db.ref('portfolio_data').once('value');
        if(snapshot.exists()) {
            const data = snapshot.val();
            Object.keys(portfolio).forEach(cat => {
                portfolio[cat].projects.forEach(p => {
                    if(data[p.id]) { p.title = data[p.id].title || p.title; p.layout = data[p.id].layout || []; }
                });
            });
        }
    }

    async function saveToCloud() {
        if(!isAdmin || !currentProj) return;
        const items = Array.from(document.querySelectorAll('.miro-item')).map(el => ({
            src: el.querySelector('img').src, x: el.style.left, y: el.style.top, w: el.style.width
        }));
        await db.ref('portfolio_data/' + currentProj.id).set({
            title: document.getElementById('lvl4Title').innerText,
            layout: items
        });
    }

    // --- 5. 渲染逻辑 (各级堆叠效果) ---
    async function showLevel(lvl, cat = '') {
        await syncFromCloud();
        currentLvl = lvl; if(cat) currentCat = cat;
        document.querySelectorAll('.view-layer').forEach(el => el.classList.remove('active'));
        document.getElementById('lvl4').style.display = (lvl === 4) ? 'flex' : 'none';

        if(lvl === 2) renderCatGrid();
        if(lvl === 3) renderProjGrid();
        if(lvl === 4) {
            document.getElementById('lvl4Title').innerText = currentProj.title;
            document.getElementById('lvl4CatTag').innerText = currentCat;
            loadBoard(); resetViewport();
        }
        document.getElementById('lvl' + lvl).classList.add('active');
        document.documentElement.style.setProperty('--bg-blur', [0, 15, 30, 0][lvl-1] + 'px');
        document.getElementById('mainNav').classList.toggle('visible', lvl > 1);
    }

    function renderCatGrid() {
        const grid = document.getElementById('catGrid');
        grid.innerHTML = Object.keys(portfolio).map(cat => {
            const projects = portfolio[cat].projects;
            const topThumb = projects[0]?.layout?.slice(-1)[0]?.src || null;
            return `<div class="stack-container" onclick="showLevel(3, '${cat}')">
                <div class="neural-stack">
                    <div class="neural-layer layer-3"></div>
                    <div class="neural-layer layer-2">${topThumb ? `<img src="${topThumb}">` : ``}</div>
                    <div class="neural-layer layer-1"><img src="${portfolio[cat].thumb}"></div>
                </div>
                <div class="stack-label">${cat}</div>
            </div>`;
        }).join('');
    }

    function renderProjGrid() {
        const grid = document.getElementById('projGrid');
        grid.innerHTML = portfolio[currentCat].projects.map(p => {
            const topImg = p.layout?.slice(-1)[0]?.src;
            return `<div class="stack-container" id="sc-${p.id}">
                <div class="neural-stack">
                    <div class="neural-layer layer-3"></div>
                    <div class="neural-layer layer-2"></div>
                    <div class="neural-layer layer-1">${topImg ? `<img src="${topImg}">` : `<div style="padding:40px; color:#eee">⬡</div>`}</div>
                </div>
                <div class="stack-label">${p.title}</div>
            </div>`;
        }).join('');
        portfolio[currentCat].projects.forEach(p => { document.getElementById(`sc-${p.id}`).onclick = () => { currentProj = p; showLevel(4); }; });
    }

    // --- 6. MIRO 画布引擎 ---
    const viewport = document.getElementById('miro-viewport');
    const board = document.getElementById('lvl4');

    board.addEventListener('wheel', e => {
        if(currentLvl !== 4) return;
        e.preventDefault();
        const delta = e.deltaY > 0 ? 0.9 : 1.1;
        const newZoom = Math.min(Math.max(zoom * delta, 0.1), 5);
        panX = e.clientX - (e.clientX - panX) * (newZoom / zoom);
        panY = e.clientY - (e.clientY - panY) * (newZoom / zoom);
        zoom = newZoom; updateViewport();
    }, { passive: false });

    board.onmousedown = (e) => {
        if(currentLvl !== 4 || e.target.id === 'lvl4Title') return;
        if(e.button === 1 || e.button === 2) { isPanning = true; return; }
        const item = e.target.closest('.miro-item');
        if(selectedItem) selectedItem.classList.remove('selected');
        if(item) {
            selectedItem = item; item.classList.add('selected'); viewport.appendChild(item);
            if(e.target.classList.contains('resizer')) { isResizing = true; resizeTarget = item; startX = e.clientX; startW = item.offsetWidth; }
            else { isDragging = true; dragTarget = item; startX = (e.clientX/zoom)-item.offsetLeft; startY = (e.clientY/zoom)-item.offsetTop; }
        }
    };

    window.onmousemove = (e) => {
        updateMouse(e.clientX, e.clientY);
        if(currentLvl !== 4) return;
        if(isPanning) { panX += e.movementX; panY += e.movementY; updateViewport(); }
        else if(isResizing) { resizeTarget.style.width = (startW + (e.clientX - startX) / zoom) + 'px'; }
        else if(isDragging) { dragTarget.style.left = (e.clientX/zoom-startX)+'px'; dragTarget.style.top = (e.clientY/zoom-startY)+'px'; }
    };
    window.onmouseup = () => isPanning = isDragging = isResizing = false;

    function loadBoard() {
        viewport.innerHTML = '';
        (currentProj.layout || []).forEach(item => {
            const div = document.createElement('div');
            div.className = 'miro-item'; div.style.left = item.x; div.style.top = item.y; div.style.width = item.w;
            div.innerHTML = `<img src="${item.src}"><div class="resizer"></div>`;
            viewport.appendChild(div);
        });
    }

    function handleUpload(e) {
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
            const div = document.createElement('div');
            div.className = 'miro-item'; div.style.width = '300px';
            div.style.left = (window.innerWidth/2-panX)/zoom + 'px'; div.style.top = (window.innerHeight/2-panY)/zoom + 'px';
            div.innerHTML = `<img src="${ev.target.result}"><div class="resizer"></div>`;
            viewport.appendChild(div);
        };
        reader.readAsDataURL(file);
    }
    
    function updateViewport() { viewport.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`; }
    function resetViewport() { zoom = 1; panX = 0; panY = 0; updateViewport(); }

    // --- 7. 背景粒子特效 ---
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    // m 对象用于记录鼠标位置、平滑位置以及瞬时速度 (vx, vy)
    let m = { x: 0, y: 0, smX: 0, smY: 0, vx: 0, vy: 0 };

    window.addEventListener('mousemove', e => { 
        m.x = e.clientX; 
        m.y = e.clientY; 
    });

    class P {
        constructor() {
            this.x = Math.random() * canvas.width; 
            this.y = Math.random() * canvas.height;
            // 初始大小：2.0 - 4.0 像素，更有存在感
            this.bs = Math.random() * 2 + 2; 
            this.s = this.bs;
            this.c = ['#4285F4', '#34A853', '#FBBC05', '#EA4335', '#9b59b6'][Math.floor(Math.random() * 5)];
            this.v = { x: (Math.random() - 0.5) * 0.3, y: (Math.random() - 0.5) * 0.3 };
            this.st = 1; // 伸缩倍率
            this.a = 0;  // 旋转角度
        }
        update() {
            this.x += this.v.x; 
            this.y += this.v.y;
            
            // 边界反弹
            if(this.x < 0 || this.x > canvas.width) this.v.x *= -1;
            if(this.y < 0 || this.y > canvas.height) this.v.y *= -1;

            // 计算粒子与平滑鼠标位置的距离
            let d = Math.hypot(m.smX - this.x, m.smY - this.y);
            
            if(d < 180) {
                let f = (180 - d) / 180;
                // 鼠标靠近时变大
                this.s = this.bs + f * 25;
                // 胶囊拉伸：基于鼠标速度，0.15 是你要求的缩短后的比例
                let spd = Math.hypot(m.vx, m.vy);
                this.st = 1 + (spd * 0.15 * f);
                // 旋转角度：指向鼠标移动的方向
                this.a = Math.atan2(m.vy, m.vx);
            } else {
                // 远离鼠标时，平滑恢复初始状态
                this.s += (this.bs - this.s) * 0.1;
                this.st += (1 - this.st) * 0.1;
            }
            this.draw();
        }
        draw() {
            ctx.save(); 
            ctx.translate(this.x, this.y); 
            ctx.rotate(this.a);
            ctx.beginPath(); 
            // 绘制椭圆：s*st 是长度，s 是宽度
            ctx.ellipse(0, 0, this.s * this.st, this.s, 0, 0, Math.PI * 2);
            ctx.fillStyle = this.c; 
            // 在二级、三级菜单时，currentLvl 会让背景变模糊，这里自动调低透明度
            ctx.globalAlpha = (currentLvl > 1) ? 0.4 : 0.7; 
            ctx.fill(); 
            ctx.restore();
        }
    }

    function init() {
        canvas.width = window.innerWidth; 
        canvas.height = window.innerHeight;
        // 增加到 120 个粒子
        particles = Array.from({length: 120}, () => new P());
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 核心：平滑鼠标移动 (Ease Out)，产生顺滑的追随感
        let px = m.smX; 
        let py = m.smY;
        m.smX += (m.x - m.smX) * 0.12; 
        m.smY += (m.y - m.smY) * 0.12;
        
        // 计算每一帧鼠标滑动的瞬时速度向量
        m.vx = m.smX - px; 
        m.vy = m.smY - py;

        particles.forEach(p => p.update());
        requestAnimationFrame(animate);
    }

    init(); 
    animate();
    window.addEventListener('resize', init);

</script>
</body>
</html>



